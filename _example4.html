<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OWA-EPANET Toolkit: Chlorine Dosage Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extrastylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OWA-EPANET Toolkit
   &#160;<span id="projectnumber">2.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_example4.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Chlorine Dosage Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example illustrates how the Toolkit could be used to determine the lowest dose of chlorine applied at the entrance to a distribution system needed to ensure that a minimum residual is met throughout the system. We assume that the EPANET input file contains the proper set of kinetic coefficients that describe the rate at which chlorine will decay in the system being studied. In the example code, the ID label of the source node is contained in <code>SourceID</code>, the minimum residual target is given by <code>Ctarget</code>, and the target is only checked after a start-up duration of 5 days (432,000 seconds). To keep the code more readable, no error checking is made on the results returned from the Toolkit function calls.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="epanet2__2_8h.html">epanet2_2.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> cl2dose(<span class="keywordtype">char</span> *SourceID, <span class="keywordtype">double</span> Ctarget)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, nnodes, sourceindex, violation;</div>
<div class="line">    <span class="keywordtype">double</span> c, csource;</div>
<div class="line">    <span class="keywordtype">long</span> t, tstep;</div>
<div class="line">    <a class="code" href="epanet2__2_8h.html#ac1b7237e65fbaad96c05cc847adc0aeb">EN_Project</a> ph;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open the toolkit &amp; obtain a hydraulic solution</span></div>
<div class="line">    <a class="code" href="group___project.html#gae76d7818d6486d52e300b03df8d91a3c">EN_createproject</a>(&amp;ph);</div>
<div class="line">    <a class="code" href="group___project.html#ga0b3789dc721a19a595253958dbfe44cc">EN_open</a>(ph, <span class="stringliteral">&quot;example3.inp&quot;</span>, <span class="stringliteral">&quot;example3.rpt&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    <a class="code" href="group___hydraulics.html#ga40fd01709eefd8c69f3ba1d9b1c6745c">EN_solveH</a>(ph);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get the number of nodes and the source node&#39;s index</span></div>
<div class="line">    <a class="code" href="group___project.html#gaa9df3fd0c1284725cb2bda1853c443f5">EN_getcount</a>(ph, <a class="code" href="epanet2__enums_8h.html#ga9fab0d1b11a0670601f9bc4dfa670105a9506750f3b6412c8d871509977417623">EN_NODECOUNT</a>, &amp;nnodes);</div>
<div class="line">    <a class="code" href="group___nodes.html#gadc7245377fb722fdff573c180ca7c503">EN_getnodeindex</a>(ph, SourceID, &amp;sourceindex);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup the system to analyze for chlorine</span></div>
<div class="line">    <span class="comment">// (in case it was not done in the input file)</span></div>
<div class="line">    <a class="code" href="group___options.html#ga7c669042b0688f880ba6b11cdd0a4142">EN_setqualtype</a>(ph, <a class="code" href="epanet2__enums_8h.html#ga7b8b382d79f8829962c5fe3172ac4d13a1b741c34120cef94de4c429f7f587718">EN_CHEM</a>, <span class="stringliteral">&quot;Chlorine&quot;</span>, <span class="stringliteral">&quot;mg/L&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open the water quality solver</span></div>
<div class="line">    <a class="code" href="group___quality.html#gaa855b2c4080d0d495ff60fb29136f4eb">EN_openQ</a>(ph);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Begin the search for the source concentration</span></div>
<div class="line">    csource = 0.0;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update source concentration to next level</span></div>
<div class="line">        csource = csource + 0.1;</div>
<div class="line">        <a class="code" href="group___nodes.html#ga198a2c196811a6c1fbdfd7af48fa5229">EN_setnodevalue</a>(ph, sourceindex, <a class="code" href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da0a1b1170bca5d2b8e898f9cc74749bc6">EN_SOURCEQUAL</a>, csource);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Run WQ simulation checking for target violations</span></div>
<div class="line">        violation = 0;</div>
<div class="line">        <a class="code" href="group___quality.html#ga1b16810a6b448505dbcbe8a58db61c61">EN_initQ</a>(ph, 0);</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">            <a class="code" href="group___quality.html#ga14670fad25cdc258dd50f1a6ff6de157">EN_runQ</a>(ph, &amp;t);</div>
<div class="line">            <span class="keywordflow">if</span> (t &gt; 432000) {</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;=nnodes; i++) {</div>
<div class="line">                    <a class="code" href="group___nodes.html#gaa2c1ed2eeda30aee890c1bacb47cbd7e">EN_getnodevalue</a>(ph, i, <a class="code" href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da828ef7fd7bc79ddc7cdf1c0eb7d5a9a8">EN_QUALITY</a>, &amp;c);</div>
<div class="line">                    <span class="keywordflow">if</span> (c &lt; Ctarget) {</div>
<div class="line">                        violation = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <a class="code" href="group___quality.html#ga1416beb3488ac4321de15de117605ec5">EN_nextQ</a>(ph, &amp;tstep);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// End WQ run if violation found</span></div>
<div class="line">        } <span class="keywordflow">while</span> (!violation &amp;&amp; tstep &gt; 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Continue search if violation found</span></div>
<div class="line">    } <span class="keywordflow">while</span> (violation &amp;&amp; csource &lt;= 4.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close up the WQ solver and delete the project</span></div>
<div class="line">    <a class="code" href="group___quality.html#gaad000a9f667235eafc442957528e7253">EN_closeQ</a>(ph);</div>
<div class="line">    <a class="code" href="group___project.html#gacc2a467ed37ac7b7f7c4db42cdfbd4d2">EN_deleteproject</a>(ph);</div>
<div class="line">    <span class="keywordflow">return</span> csource;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup___nodes_html_gadc7245377fb722fdff573c180ca7c503"><div class="ttname"><a href="group___nodes.html#gadc7245377fb722fdff573c180ca7c503">EN_getnodeindex</a></div><div class="ttdeci">int EN_getnodeindex(EN_Project ph, char *id, int *out_index)</div><div class="ttdoc">Gets the index of a node given its ID name.</div></div>
<div class="ttc" id="agroup___quality_html_ga1416beb3488ac4321de15de117605ec5"><div class="ttname"><a href="group___quality.html#ga1416beb3488ac4321de15de117605ec5">EN_nextQ</a></div><div class="ttdeci">int EN_nextQ(EN_Project ph, long *out_tStep)</div><div class="ttdoc">Advances a water quality simulation over the time until the next hydraulic event.</div></div>
<div class="ttc" id="agroup___quality_html_ga14670fad25cdc258dd50f1a6ff6de157"><div class="ttname"><a href="group___quality.html#ga14670fad25cdc258dd50f1a6ff6de157">EN_runQ</a></div><div class="ttdeci">int EN_runQ(EN_Project ph, long *out_currentTime)</div><div class="ttdoc">Makes hydraulic and water quality results at the start of the current time period available to a proj...</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_gae538c7e564d9bd7c5a1f841b107c417da828ef7fd7bc79ddc7cdf1c0eb7d5a9a8"><div class="ttname"><a href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da828ef7fd7bc79ddc7cdf1c0eb7d5a9a8">EN_QUALITY</a></div><div class="ttdoc">Current computed quality (read only)</div><div class="ttdef"><b>Definition:</b> epanet2_enums.h:51</div></div>
<div class="ttc" id="agroup___project_html_ga0b3789dc721a19a595253958dbfe44cc"><div class="ttname"><a href="group___project.html#ga0b3789dc721a19a595253958dbfe44cc">EN_open</a></div><div class="ttdeci">int EN_open(EN_Project ph, const char *inpFile, const char *rptFile, const char *outFile)</div><div class="ttdoc">Opens an EPANET input file &amp; reads in network data.</div></div>
<div class="ttc" id="agroup___nodes_html_gaa2c1ed2eeda30aee890c1bacb47cbd7e"><div class="ttname"><a href="group___nodes.html#gaa2c1ed2eeda30aee890c1bacb47cbd7e">EN_getnodevalue</a></div><div class="ttdeci">int EN_getnodevalue(EN_Project ph, int index, int property, double *out_value)</div><div class="ttdoc">Retrieves a property value for a node.</div></div>
<div class="ttc" id="agroup___nodes_html_ga198a2c196811a6c1fbdfd7af48fa5229"><div class="ttname"><a href="group___nodes.html#ga198a2c196811a6c1fbdfd7af48fa5229">EN_setnodevalue</a></div><div class="ttdeci">int EN_setnodevalue(EN_Project ph, int index, int property, double value)</div><div class="ttdoc">Sets a property value for a node.</div></div>
<div class="ttc" id="aepanet2__2_8h_html_ac1b7237e65fbaad96c05cc847adc0aeb"><div class="ttname"><a href="epanet2__2_8h.html#ac1b7237e65fbaad96c05cc847adc0aeb">EN_Project</a></div><div class="ttdeci">struct Project * EN_Project</div><div class="ttdoc">The EPANET Project wrapper object.</div><div class="ttdef"><b>Definition:</b> epanet2_2.h:49</div></div>
<div class="ttc" id="agroup___hydraulics_html_ga40fd01709eefd8c69f3ba1d9b1c6745c"><div class="ttname"><a href="group___hydraulics.html#ga40fd01709eefd8c69f3ba1d9b1c6745c">EN_solveH</a></div><div class="ttdeci">int EN_solveH(EN_Project ph)</div><div class="ttdoc">Runs a complete hydraulic simulation with results for all time periods written to a temporary hydraul...</div></div>
<div class="ttc" id="agroup___project_html_gae76d7818d6486d52e300b03df8d91a3c"><div class="ttname"><a href="group___project.html#gae76d7818d6486d52e300b03df8d91a3c">EN_createproject</a></div><div class="ttdeci">int EN_createproject(EN_Project *ph)</div><div class="ttdoc">Creates an EPANET project.</div></div>
<div class="ttc" id="agroup___quality_html_gaad000a9f667235eafc442957528e7253"><div class="ttname"><a href="group___quality.html#gaad000a9f667235eafc442957528e7253">EN_closeQ</a></div><div class="ttdeci">int EN_closeQ(EN_Project ph)</div><div class="ttdoc">Closes the water quality solver, freeing all of its allocated memory.</div></div>
<div class="ttc" id="agroup___quality_html_ga1b16810a6b448505dbcbe8a58db61c61"><div class="ttname"><a href="group___quality.html#ga1b16810a6b448505dbcbe8a58db61c61">EN_initQ</a></div><div class="ttdeci">int EN_initQ(EN_Project ph, int saveFlag)</div><div class="ttdoc">Initializes a network prior to running a water quality analysis.</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_ga7b8b382d79f8829962c5fe3172ac4d13a1b741c34120cef94de4c429f7f587718"><div class="ttname"><a href="epanet2__enums_8h.html#ga7b8b382d79f8829962c5fe3172ac4d13a1b741c34120cef94de4c429f7f587718">EN_CHEM</a></div><div class="ttdoc">Chemical fate and transport.</div><div class="ttdef"><b>Definition:</b> epanet2_enums.h:229</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_ga9fab0d1b11a0670601f9bc4dfa670105a9506750f3b6412c8d871509977417623"><div class="ttname"><a href="epanet2__enums_8h.html#ga9fab0d1b11a0670601f9bc4dfa670105a9506750f3b6412c8d871509977417623">EN_NODECOUNT</a></div><div class="ttdoc">Number of nodes (junctions + tanks + reservoirs)</div><div class="ttdef"><b>Definition:</b> epanet2_enums.h:162</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_gae538c7e564d9bd7c5a1f841b107c417da0a1b1170bca5d2b8e898f9cc74749bc6"><div class="ttname"><a href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da0a1b1170bca5d2b8e898f9cc74749bc6">EN_SOURCEQUAL</a></div><div class="ttdoc">Quality source strength.</div><div class="ttdef"><b>Definition:</b> epanet2_enums.h:44</div></div>
<div class="ttc" id="agroup___options_html_ga7c669042b0688f880ba6b11cdd0a4142"><div class="ttname"><a href="group___options.html#ga7c669042b0688f880ba6b11cdd0a4142">EN_setqualtype</a></div><div class="ttdeci">int EN_setqualtype(EN_Project ph, int qualType, char *chemName, char *chemUnits, char *traceNode)</div><div class="ttdoc">Sets the type of water quality analysis to run.</div></div>
<div class="ttc" id="agroup___project_html_gacc2a467ed37ac7b7f7c4db42cdfbd4d2"><div class="ttname"><a href="group___project.html#gacc2a467ed37ac7b7f7c4db42cdfbd4d2">EN_deleteproject</a></div><div class="ttdeci">int EN_deleteproject(EN_Project ph)</div><div class="ttdoc">Deletes a currently opened EPANET project.</div></div>
<div class="ttc" id="agroup___quality_html_gaa855b2c4080d0d495ff60fb29136f4eb"><div class="ttname"><a href="group___quality.html#gaa855b2c4080d0d495ff60fb29136f4eb">EN_openQ</a></div><div class="ttdeci">int EN_openQ(EN_Project ph)</div><div class="ttdoc">Opens a project's water quality solver.</div></div>
<div class="ttc" id="aepanet2__2_8h_html"><div class="ttname"><a href="epanet2__2_8h.html">epanet2_2.h</a></div></div>
<div class="ttc" id="agroup___project_html_gaa9df3fd0c1284725cb2bda1853c443f5"><div class="ttname"><a href="group___project.html#gaa9df3fd0c1284725cb2bda1853c443f5">EN_getcount</a></div><div class="ttdeci">int EN_getcount(EN_Project ph, int object, int *out_count)</div><div class="ttdoc">Retrieves the number of objects of a given type in a project.</div></div>
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="footer">OWA-EPANET Toolkit 2.2 &copy 2019</li> -->
  </ul>
</div>
</body>
</html>
